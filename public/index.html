<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì¿ íŒ¡ ì˜¤ë”ì‹œíŠ¸ ìˆ˜ì§‘ê¸°</title>
</head>
<body>
  <h2>ğŸ“¦ ì¿ íŒ¡ ì˜¤ë”ì‹œíŠ¸ ìˆ˜ì§‘ê¸°</h2>

  <button onclick="fetchToday()">ì˜¤ëŠ˜</button>
  <button onclick="fetchYesterday()">ì–´ì œ</button>
  <br><br>

  <label>ì‹œì‘ì¼: <input type="datetime-local" id="fromDate"></label>
  <label>ì¢…ë£Œì¼: <input type="datetime-local" id="toDate"></label>
  <button onclick="fetchCustom()">ê¸°ê°„ ìˆ˜ì§‘</button>

  <p id="result">â³ ìš”ì²­ ì „ì…ë‹ˆë‹¤.</p>

  <script>
    function formatDate(date) {
      // ì˜ˆ: 2025-05-12T00:00:00
      return date.toISOString().split(".")[0];
    }

    async function fetchOrders(from, to) {
      const resultElem = document.getElementById("result");
      resultElem.innerText = "â³ ìš”ì²­ ì¤‘...";

      console.log("ğŸ“¤ ìš”ì²­ ë‚ ì§œ:", from, "~", to);

      try {
        const res = await fetch(`/fetch-orders?createdAtFrom=${encodeURIComponent(from)}&createdAtTo=${encodeURIComponent(to)}`);
        const data = await res.json();

        console.log("ğŸ“¥ ì„œë²„ ì‘ë‹µ:", data);

        if (data.status === "success") {
          resultElem.innerText = `âœ… ${data.inserted}ê±´ ì €ì¥ ì™„ë£Œ`;
        } else {
          console.log("âš ï¸ ì—ëŸ¬ ë©”ì‹œì§€:", data.message);
          resultElem.innerText = `âš ï¸ ì‹¤íŒ¨: ${JSON.stringify(data.message, null, 2)}`;
        }
      } catch (e) {
        console.log("âŒ ì˜ˆì™¸ ë°œìƒ:", e);
        resultElem.innerText = `âŒ ì˜¤ë¥˜: ${e.message}`;
      }
    }

    function fetchToday() {
      const now = new Date();
      const from = new Date(now);
      from.setHours(0, 0, 0, 0);
      const to = new Date(now);
      to.setHours(23, 59, 59, 999);
      fetchOrders(formatDate(from), formatDate(to));
    }

    function fetchYesterday() {
      const now = new Date();
      const from = new Date(now.setDate(now.getDate() - 1));
      from.setHours(0, 0, 0, 0);
      const to = new Date(from);
      to.setHours(23, 59, 59, 999);
      fetchOrders(formatDate(from), formatDate(to));
    }

    function fetchCustom() {
      const fromInput = document.getElementById("fromDate").value;
      const toInput = document.getElementById("toDate").value;

      if (!fromInput || !toInput) {
        alert("ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      const from = new Date(fromInput);
      const to = new Date(toInput);

      fetchOrders(formatDate(from), formatDate(to));
    }
  </script>
</body>
</html>
